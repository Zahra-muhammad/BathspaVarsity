<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Watch Sports Management - Bath Spa Sports</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="watch-sports.css">
  <style>
    * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #f5e6e8 0%, #d4e4f7 100%);
  color: #1a1a1a;
  min-height: 100vh;
  padding: 30px;
}

.main-container {
  max-width: 1400px;
  margin: 0 auto;
  background: white;
  border-radius: 24px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 40px;
  border-bottom: 1px solid #f0f0f0;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.4rem;
  font-weight: 700;
  color: #ff6b6b;
  text-decoration: none;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2rem;
}

.search-bar {
  position: relative;
  flex: 1;
  max-width: 400px;
  margin: 0 40px;
}

.search-bar input {
  width: 100%;
  padding: 12px 20px 12px 45px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  transition: all 0.3s ease;
}

.search-bar input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.search-bar::before {
  content: 'üîç';
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.1rem;
}

.user-section {
  display: flex;
  align-items: center;
  gap: 20px;
}

.status-badge {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: #f0f9ff;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #0066cc;
}

.status-dot {
  width: 8px;
  height: 8px;
  background: #10b981;
  border-radius: 50%;
}

.notification-icon {
  position: relative;
  width: 40px;
  height: 40px;
  background: #f8f9fa;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.notification-icon:hover {
  background: #e9ecef;
}

.user-profile {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 16px;
  background: #f8f9fa;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.user-profile:hover {
  background: #e9ecef;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 0.9rem;
}

.content-wrapper {
  display: flex;
}

.sidebar {
  width: 260px;
  background: #fafbfc;
  padding: 30px 0;
  border-right: 1px solid #f0f0f0;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 30px;
  color: #6b7280;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  border-left: 3px solid transparent;
}

.nav-item:hover {
  background: rgba(102, 126, 234, 0.05);
  color: #667eea;
}

.nav-item.active {
  background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
  color: #667eea;
  border-left-color: #667eea;
}

.nav-icon {
  font-size: 1.3rem;
}

.main-content {
  flex: 1;
  padding: 40px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.page-title-section h1 {
  font-size: 2rem;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 8px;
}

.page-subtitle {
  color: #6b7280;
  font-size: 0.95rem;
}

.header-actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 12px 24px;
  border-radius: 10px;
  font-size: 0.95rem;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Inter', sans-serif;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background: white;
  color: #6b7280;
  border: 1px solid #e0e0e0;
}

.btn-secondary:hover {
  background: #f8f9fa;
}

.alert {
  padding: 16px 24px;
  border-radius: 12px;
  margin-bottom: 20px;
  display: none;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.alert.show {
  display: block;
}

.alert-success {
  background: #d1fae5;
  border: 1px solid #059669;
  color: #059669;
  font-weight: 500;
}

.alert-error {
  background: #fee2e2;
  border: 1px solid #dc2626;
  color: #dc2626;
  font-weight: 500;
}

.category-tabs {
  display: flex;
  gap: 12px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.tab-btn {
  padding: 10px 20px;
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  color: #6b7280;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Inter', sans-serif;
}

.tab-btn:hover {
  background: #f8f9fa;
}

.tab-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: transparent;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  border: 1px solid #f0f0f0;
  border-radius: 16px;
  padding: 24px;
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: #667eea;
  margin-bottom: 8px;
}

.stat-label {
  color: #6b7280;
  font-size: 0.9rem;
  font-weight: 500;
}

.media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 24px;
}

.media-card {
  background: white;
  border: 1px solid #f0f0f0;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.media-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 16px 32px rgba(0, 0, 0, 0.1);
  border-color: #667eea;
}

.media-thumbnail {
  width: 100%;
  height: 220px;
  object-fit: cover;
  background: #f8f9fa;
  display: block;
}

.media-thumbnail iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.media-content {
  padding: 20px;
}

.media-category {
  display: inline-block;
  padding: 4px 12px;
  background: #e0e7ff;
  color: #667eea;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.source-badge {
  display: inline-block;
  padding: 4px 12px;
  background: #f3f4f6;
  color: #6b7280;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: 6px;
}

.media-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 8px;
  line-height: 1.4;
}

.media-description {
  color: #6b7280;
  font-size: 0.9rem;
  margin-bottom: 16px;
  line-height: 1.6;
}

.media-actions {
  display: flex;
  gap: 10px;
}

.btn-small {
  padding: 8px 16px;
  font-size: 0.85rem;
  flex: 1;
}

.btn-danger {
  background: #fee2e2;
  color: #dc2626;
  border: 1px solid #fecaca;
}

.btn-danger:hover {
  background: #fecaca;
}

.no-media {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
  color: #6b7280;
  font-size: 1.1rem;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: 20px;
  padding: 40px;
  max-width: 700px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-content h2 {
  font-size: 1.6rem;
  font-weight: 700;
  margin-bottom: 24px;
  color: #1a1a1a;
}

.upload-type-selector {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 24px;
}

.upload-type-btn {
  padding: 14px;
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.95rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-family: 'Inter', sans-serif;
}

.upload-type-btn:hover {
  background: #f8f9fa;
  border-color: #667eea;
}

.upload-type-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  color: white;
}

.upload-method {
  display: none;
}

.upload-method.active {
  display: block;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: #374151;
  font-weight: 600;
  font-size: 0.9rem;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  font-size: 0.95rem;
  font-family: 'Inter', sans-serif;
  transition: all 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

.url-input-area {
  background: #fafbfc;
  padding: 16px;
  border-radius: 12px;
  border: 2px dashed #e0e0e0;
}

.url-input-area input {
  background: white;
}

.url-hint {
  font-size: 0.85rem;
  color: #6b7280;
  margin-top: 12px;
  line-height: 1.6;
}

.platform-icons {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.platform-icon {
  padding: 6px 12px;
  background: rgba(102, 126, 234, 0.1);
  border-radius: 8px;
  font-size: 0.8rem;
  color: #667eea;
  font-weight: 500;
}

.file-input-wrapper {
  position: relative;
}

.file-input-wrapper input[type="file"] {
  display: none;
}

.file-input-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  background: #fafbfc;
  border: 2px dashed #e0e0e0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.file-input-label:hover {
  background: rgba(102, 126, 234, 0.05);
  border-color: #667eea;
}

.upload-icon {
  font-size: 3rem;
  margin-bottom: 12px;
}

.upload-text {
  color: #6b7280;
  font-size: 0.9rem;
  line-height: 1.6;
}

.upload-text strong {
  color: #374151;
}

.file-preview {
  margin-top: 16px;
  display: none;
}

.file-preview.active {
  display: block;
}

.file-preview #previewContent {
  max-width: 100%;
  border-radius: 12px;
  overflow: hidden;
  background: #f8f9fa;
}

.file-preview video,
.file-preview img {
  width: 100%;
  max-height: 300px;
  object-fit: contain;
  display: block;
}

.file-preview-controls {
  margin-top: 12px;
  display: flex;
  gap: 10px;
  justify-content: center;
}

.preview {
  margin-top: 16px;
  max-width: 100%;
  border-radius: 12px;
  overflow: hidden;
}

.preview iframe,
.preview video,
.preview img {
  width: 100%;
  max-height: 300px;
  border-radius: 12px;
  display: block;
}

.preview iframe {
  aspect-ratio: 16/9;
  border: none;
}

.preview video {
  object-fit: contain;
  background: #000;
}

.preview img {
  object-fit: contain;
  background: #f8f9fa;
}

.modal-buttons {
  display: flex;
  gap: 12px;
  margin-top: 30px;
}

.btn-cancel {
  flex: 1;
}

@media (max-width: 1200px) {
  .media-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }

  .top-bar {
    flex-wrap: wrap;
    padding: 16px 20px;
  }

  .search-bar {
    order: 3;
    width: 100%;
    max-width: 100%;
    margin: 16px 0 0 0;
  }

  .sidebar {
    display: none;
  }

  .main-content {
    padding: 20px;
  }

  .stats-row {
    grid-template-columns: 1fr;
  }

  .media-grid {
    grid-template-columns: 1fr;
  }

  .page-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .header-actions {
    width: 100%;
    flex-direction: column;
  }

  .header-actions .btn {
    width: 100%;
    justify-content: center;
  }

  .upload-type-selector {
    grid-template-columns: 1fr;
  }

  .modal-content {
    padding: 24px;
  }

  .page-title-section h1 {
    font-size: 1.5rem;
  }
}
    
</style>
</head>
<body>
  <div class="main-container">
    <div class="top-bar">
      <a href="/admin/adminhome" class="logo">
        <div class="logo-icon">üèÉ</div>
        <span>Bath Spa Sports</span>
      </a>

      <div class="search-bar">
        <input type="text" placeholder="Search media...">
      </div>

      <div class="user-section">
        <div class="status-badge">
          <span class="status-dot"></span>
          <span>Admin Mode</span>
        </div>

        <div class="notification-icon">
          <span>üîî</span>
        </div>

        <div class="user-profile">
          <div class="user-avatar">AD</div>
          <span>Admin</span>
          <span>‚ñæ</span>
        </div>
      </div>
    </div>

    <div class="content-wrapper">
      <aside class="sidebar">
        <a href="/admin/adminhome" class="nav-item active">
          <span class="nav-icon">üìä</span>
          <span>Dashboard</span>
        </a>
        <a href="/admin/users" class="nav-item">
          <span class="nav-icon">üë•</span>
          <span>User Management</span>
        </a>
        <a href="/admin/shop" class="nav-item">
          <span class="nav-icon">üõçÔ∏è</span>
          <span>Shop Management</span>
        </a>
        <a href="/admin/watch-sports" class="nav-item">
          <span class="nav-icon">üì∫</span>
          <span>Watch Sports</span>
        </a>
        <a href="/admin/manage-player" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>Schedule & Calendar</span>
        </a>
        <a href="/admin/manage-events" class="nav-item">
          <span class="nav-icon">üéØ</span>
          <span>Events Management</span>
        </a>
        <a href="/" class="nav-item">
          <span class="nav-icon">üè†</span>
          <span>Main Site</span>
        </a>
        <a href="/logout" class="nav-item">
          <span class="nav-icon">üö™</span>
          <span>Logout</span>
        </a>
      </aside>

      <main class="main-content">
        <div class="page-header">
          <div class="page-title-section">
            <h1>Watch Sports Management</h1>
            <p class="page-subtitle">Upload and manage sports videos, highlights, and media content</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" onclick="refreshMedia()">‚Üª Refresh</button>
            <button class="btn btn-primary" onclick="openUploadModal()">+ Upload New Media</button>
          </div>
        </div>

        <div id="successMsg" class="alert alert-success"></div>
        <div id="errorMsg" class="alert alert-error"></div>

        <div class="category-tabs">
          <button class="tab-btn active" onclick="filterByCategory('all')">All Media</button>
          <button class="tab-btn" onclick="filterByCategory('full-matches')">üèüÔ∏è Full Matches</button>
          <button class="tab-btn" onclick="filterByCategory('highlights')">‚ö° Highlights</button>
          <button class="tab-btn" onclick="filterByCategory('old-matches')">üìº Old Matches</button>
          <button class="tab-btn" onclick="filterByCategory('upcoming-matches')">üìÖ Upcoming</button>
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-value" id="totalMedia">0</div>
            <div class="stat-label">Total Media</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="fullMatchesCount">0</div>
            <div class="stat-label">Full Matches</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="highlightsCount">0</div>
            <div class="stat-label">Highlights</div>
          </div>
        </div>

        <div class="media-grid" id="mediaGrid">
          <div class="no-media">Loading media...</div>
        </div>
      </main>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <h2 id="modalTitle">Upload New Media</h2>
      
      <div class="upload-type-selector">
        <button type="button" class="upload-type-btn active" data-type="url">
          üîó URL/Link Upload
        </button>
        <button type="button" class="upload-type-btn" data-type="file">
          üìÅ File Upload
        </button>
      </div>

      <form id="uploadForm">
        <div class="form-group">
          <label>Title*</label>
          <input type="text" id="mediaTitle" placeholder="e.g., Championship Finals 2024" required>
        </div>

        <div class="form-group">
          <label>Category*</label>
          <select id="mediaCategory" required>
            <option value="">Select Category</option>
            <option value="full-matches">üèüÔ∏è Full Matches</option>
            <option value="highlights">‚ö° Highlights</option>
            <option value="old-matches">üìº Old Matches</option>
            <option value="upcoming-matches">üìÖ Upcoming Matches</option>
          </select>
        </div>

        <div class="upload-method active" id="urlMethod">
          <div class="form-group">
            <label>Video/Image URL*</label>
            <div class="url-input-area">
              <input type="url" id="mediaUrl" placeholder="Paste YouTube, Instagram, TikTok, or any video/image URL here...">
              <div class="url-hint">
                üì∫ Supported: YouTube, Instagram, TikTok, Vimeo, Facebook, Twitter/X, and direct video links
              </div>
              <div class="platform-icons">
                <span class="platform-icon">üé• YouTube</span>
                <span class="platform-icon">üì∏ Instagram</span>
                <span class="platform-icon">üéµ TikTok</span>
                <span class="platform-icon">üé¨ Vimeo</span>
              </div>
            </div>
          </div>
        </div>

        <div class="upload-method" id="fileMethod">
          <div class="form-group">
            <label>Upload File*</label>
            <div class="file-input-wrapper">
              <input type="file" id="fileInput" accept="video/*,image/*">
              <label for="fileInput" class="file-input-label">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">
                  <strong>Click to upload</strong> or drag and drop<br>
                  Video or image files
                </div>
              </label>
            </div>
            <div class="file-preview" id="filePreview">
              <div id="previewContent"></div>
              <div class="file-preview-controls">
                <button type="button" class="btn btn-secondary btn-small" onclick="changeFile()">Change File</button>
                <button type="button" class="btn btn-danger btn-small" onclick="removeFile()">Remove</button>
              </div>
            </div>
          </div>
        </div>

        <div id="urlPreview" class="preview"></div>

        <div class="form-group">
          <label>Description</label>
          <textarea id="mediaDescription" placeholder="Add a description for this media..."></textarea>
        </div>

        <div class="modal-buttons">
          <button type="button" class="btn btn-secondary btn-cancel" onclick="closeUploadModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" id="uploadBtn">Upload Media</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Global variables
let allMedia = [];
let currentFilter = 'all';
let currentUploadType = 'url';
let currentFile = null;

// Initialize on page load
window.addEventListener('DOMContentLoaded', () => {
  loadMedia();
  setupUploadTypeToggle();
  setupFileUpload();
  setupURLPreview();
  setupFormSubmit();
});

// Setup upload type toggle (URL vs File)
function setupUploadTypeToggle() {
  document.querySelectorAll('.upload-type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.upload-type-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.upload-method').forEach(m => m.classList.remove('active'));
      
      btn.classList.add('active');
      currentUploadType = btn.dataset.type;
      document.getElementById(`${currentUploadType}Method`).classList.add('active');
      
      // Clear previews
      document.getElementById('urlPreview').innerHTML = '';
      document.getElementById('filePreview').classList.remove('active');
    });
  });
}

// Setup file upload
function setupFileUpload() {
  const fileInput = document.getElementById('fileInput');
  const dropZone = document.querySelector('.file-input-label');

  fileInput.addEventListener('change', handleFileSelect);

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#667eea';
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.style.borderColor = '#e0e0e0';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#e0e0e0';
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files;
      handleFileSelect({ target: { files: files } });
    }
  });
}

function handleFileSelect(e) {
  const file = e.target.files[0];
  if (!file) return;

  if (!file.type.startsWith('video/') && !file.type.startsWith('image/')) {
    showError('Please upload a video or image file');
    return;
  }

  if (file.size > 100 * 1024 * 1024) { // 100MB limit
    showError('File size must be less than 100MB');
    return;
  }

  currentFile = file;
  const reader = new FileReader();
  
  reader.onload = (e) => {
    const previewContent = document.getElementById('previewContent');
    const filePreview = document.getElementById('filePreview');
    
    if (file.type.startsWith('video/')) {
      previewContent.innerHTML = `<video src="${e.target.result}" controls></video>`;
    } else {
      previewContent.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
    }
    
    filePreview.classList.add('active');
  };
  
  reader.readAsDataURL(file);
}

function changeFile() {
  document.getElementById('fileInput').click();
}

function removeFile() {
  currentFile = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('filePreview').classList.remove('active');
}

// Setup URL preview
function setupURLPreview() {
  const urlInput = document.getElementById('mediaUrl');
  const preview = document.getElementById('urlPreview');

  urlInput.addEventListener('input', (e) => {
    const url = e.target.value.trim();
    if (!url) {
      preview.innerHTML = '';
      return;
    }

    const embedData = convertToEmbedUrl(url);
    
    if (embedData.type === 'youtube' || embedData.type === 'vimeo') {
      preview.innerHTML = `<iframe src="${embedData.embedUrl}" allowfullscreen></iframe>`;
    } else if (embedData.type === 'instagram') {
      preview.innerHTML = `<iframe src="${embedData.embedUrl}" allowfullscreen></iframe>`;
    } else if (embedData.type === 'video') {
      preview.innerHTML = `<video src="${embedData.embedUrl}" controls></video>`;
    } else if (embedData.type === 'image') {
      preview.innerHTML = `<img src="${embedData.embedUrl}" alt="Preview">`;
    } else {
      preview.innerHTML = `<p style="color: #6b7280; padding: 20px; text-align: center;">Preview for ${embedData.source}</p>`;
    }
  });
}

// Convert URL to embed format
function convertToEmbedUrl(url) {
  // YouTube
  const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
  const youtubeMatch = url.match(youtubeRegex);
  if (youtubeMatch) {
    return {
      type: 'youtube',
      embedUrl: `https://www.youtube.com/embed/${youtubeMatch[1]}`,
      source: 'YouTube'
    };
  }

  // Instagram
  if (url.includes('instagram.com')) {
    const cleanUrl = url.split('?')[0];
    return {
      type: 'instagram',
      embedUrl: `${cleanUrl}embed`,
      source: 'Instagram'
    };
  }

  // TikTok
  if (url.includes('tiktok.com')) {
    return {
      type: 'tiktok',
      embedUrl: url,
      source: 'TikTok'
    };
  }

  // Vimeo
  const vimeoRegex = /vimeo\.com\/(\d+)/;
  const vimeoMatch = url.match(vimeoRegex);
  if (vimeoMatch) {
    return {
      type: 'vimeo',
      embedUrl: `https://player.vimeo.com/video/${vimeoMatch[1]}`,
      source: 'Vimeo'
    };
  }

  // Twitter/X
  if (url.includes('twitter.com') || url.includes('x.com')) {
    return {
      type: 'twitter',
      embedUrl: url,
      source: 'Twitter/X'
    };
  }

  // Direct video
  if (url.match(/\.(mp4|webm|ogg|mov)$/i)) {
    return {
      type: 'video',
      embedUrl: url,
      source: 'Direct Link'
    };
  }

  // Direct image
  if (url.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
    return {
      type: 'image',
      embedUrl: url,
      source: 'Direct Link'
    };
  }

  return {
    type: 'generic',
    embedUrl: url,
    source: 'External Link'
  };
}

// Setup form submission
function setupFormSubmit() {
  document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    await uploadMedia();
  });
}

// Upload media
async function uploadMedia() {
  const title = document.getElementById('mediaTitle').value.trim();
  const category = document.getElementById('mediaCategory').value;
  const description = document.getElementById('mediaDescription').value.trim();
  const url = document.getElementById('mediaUrl').value.trim();

  if (!title || !category) {
    showError('Please fill in all required fields');
    return;
  }

  if (currentUploadType === 'file' && !currentFile) {
    showError('Please select a file to upload');
    return;
  }

  if (currentUploadType === 'url' && !url) {
    showError('Please enter a URL');
    return;
  }

  const uploadBtn = document.getElementById('uploadBtn');
  uploadBtn.disabled = true;
  uploadBtn.textContent = 'Uploading...';

  try {
    const formData = new FormData();
    formData.append('title', title);
    formData.append('category', category);
    formData.append('description', description);

    if (currentUploadType === 'file') {
      formData.append('file', currentFile);
      formData.append('mediaType', currentFile.type.startsWith('video/') ? 'video' : 'image');
    } else {
      const embedData = convertToEmbedUrl(url);
      formData.append('url', embedData.embedUrl);
      formData.append('originalUrl', url);
      formData.append('source', embedData.source);
      formData.append('embedType', embedData.type);
      formData.append('mediaType', embedData.type === 'image' ? 'image' : 'video');
    }

    const response = await fetch('/api/watch-sports/upload', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Upload failed');
    }

    showSuccess('Media uploaded successfully!');
    closeUploadModal();
    loadMedia();
  } catch (error) {
    console.error('Upload error:', error);
    showError('Failed to upload media: ' + error.message);
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.textContent = 'Upload Media';
  }
}

// Load all media
async function loadMedia() {
  try {
    const response = await fetch('/api/watch-sports/media');
    if (!response.ok) throw new Error('Failed to load media');
    
    allMedia = await response.json();
    displayMedia(allMedia);
    updateStats();
  } catch (error) {
    console.error('Load error:', error);
    document.getElementById('mediaGrid').innerHTML = 
      '<div class="no-media">Failed to load media</div>';
  }
}

// Display media
function displayMedia(mediaList) {
  const grid = document.getElementById('mediaGrid');
  
  if (mediaList.length === 0) {
    grid.innerHTML = '<div class="no-media">No media found. Upload your first video or image!</div>';
    return;
  }

  grid.innerHTML = mediaList.map(item => createMediaCard(item)).join('');
}

// Create media card
function createMediaCard(item) {
  let thumbnailHtml = '';
  
  if (item.embedType === 'youtube' || item.embedType === 'vimeo' || item.embedType === 'instagram') {
    thumbnailHtml = `<div class="media-thumbnail"><iframe src="${item.url}" allowfullscreen></iframe></div>`;
  } else if (item.mediaType === 'video') {
    thumbnailHtml = `<div class="media-thumbnail"><video src="${item.url}" muted></video></div>`;
  } else {
    thumbnailHtml = `<img src="${item.url}" alt="${item.title}" class="media-thumbnail">`;
  }

  const categoryEmojis = {
    'full-matches': 'üèüÔ∏è',
    'highlights': '‚ö°',
    'old-matches': 'üìº',
    'upcoming-matches': 'üìÖ'
  };

  const categoryName = item.category.toUpperCase().replace('-', ' ');
  const emoji = categoryEmojis[item.category] || 'üì∫';

  return `
    <div class="media-card">
      ${thumbnailHtml}
      <div class="media-content">
        <span class="media-category">${emoji} ${categoryName}</span>
        ${item.source ? `<span class="source-badge">${item.source}</span>` : ''}
        <h3 class="media-title">${item.title}</h3>
        <p class="media-description">${item.description || 'No description'}</p>
        <div class="media-actions">
          <button class="btn btn-secondary btn-small" onclick="viewMedia('${item._id}')">üëÅÔ∏è View</button>
          <button class="btn btn-danger btn-small" onclick="deleteMedia('${item._id}')">üóëÔ∏è Delete</button>
        </div>
      </div>
    </div>
  `;
}

// Update statistics
function updateStats() {
  document.getElementById('totalMedia').textContent = allMedia.length;
  
  const fullMatches = allMedia.filter(m => m.category === 'full-matches').length;
  document.getElementById('fullMatchesCount').textContent = fullMatches;
  
  const highlights = allMedia.filter(m => m.category === 'highlights').length;
  document.getElementById('highlightsCount').textContent = highlights;
}

// Filter by category
function filterByCategory(category) {
  currentFilter = category;
  
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  if (category === 'all') {
    displayMedia(allMedia);
  } else {
    const filtered = allMedia.filter(m => m.category === category);
    displayMedia(filtered);
  }
}

// View media (opens in new tab/modal)
function viewMedia(mediaId) {
  const media = allMedia.find(m => m._id === mediaId);
  if (!media) return;

  // Open in new tab
  if (media.originalUrl) {
    window.open(media.originalUrl, '_blank');
  } else {
    window.open(media.url, '_blank');
  }
}

// Delete media
async function deleteMedia(mediaId) {
  if (!confirm('Are you sure you want to delete this media?')) return;

  try {
    const response = await fetch(`/api/watch-sports/media/${mediaId}`, {
      method: 'DELETE'
    });

    if (!response.ok) throw new Error('Delete failed');

    showSuccess('Media deleted successfully!');
    loadMedia();
  } catch (error) {
    console.error('Delete error:', error);
    showError('Failed to delete media: ' + error.message);
  }
}

// Modal functions
function openUploadModal() {
  document.getElementById('uploadModal').classList.add('active');
}

function closeUploadModal() {
  document.getElementById('uploadModal').classList.remove('active');
  document.getElementById('uploadForm').reset();
  document.getElementById('urlPreview').innerHTML = '';
  document.getElementById('filePreview').classList.remove('active');
  currentFile = null;
  
  // Reset to URL upload by default
  document.querySelectorAll('.upload-type-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.upload-method').forEach(m => m.classList.remove('active'));
  document.querySelector('[data-type="url"]').classList.add('active');
  document.getElementById('urlMethod').classList.add('active');
  currentUploadType = 'url';
}

// Refresh media
function refreshMedia() {
  loadMedia();
}

// Show messages
function showSuccess(message) {
  const successMsg = document.getElementById('successMsg');
  successMsg.textContent = message;
  successMsg.classList.add('show');
  setTimeout(() => successMsg.classList.remove('show'), 4000);
}

function showError(message) {
  const errorMsg = document.getElementById('errorMsg');
  errorMsg.textContent = message;
  errorMsg.classList.add('show');
  setTimeout(() => errorMsg.classList.remove('show'), 5000);
}

// Close modal when clicking outside
document.getElementById('uploadModal')?.addEventListener('click', (e) => {
  if (e.target.id === 'uploadModal') {
    closeUploadModal();
  }
});

  </script>
</body>
</html>